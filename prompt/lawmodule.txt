현재 Streamlit 투자보고서 자동 생성 프로젝트에
PE 투자회사용 Legal Agent 모듈을 고도화해서 추가 구현하라.

[목표]
단순 계약서 요약이 아니라 투자 딜 실무 산출물 수준의 법무 분석을 생성하고,
이미 탑재된 회계/재무 모듈(FinanceCost/QoE 등)과 연계하여
법무 이슈의 "회계적/재무적 영향"을 버튼 기반으로 즉시 분석할 수 있게 한다.

────────────────────────────
[추가 기능(법무) - 필수]

1) Deal Killer Detector
   - Change of Control, Termination, Exclusivity, Non-compete, MAC 관련 위험 조항 탐지
   - 결과 스키마:
     deal_breakers[]               // 각 항목: {type, summary, why_risky, suggested_fix}
     risk_level (G/Y/R)
     recommended_actions[]
     evidence_quotes[]             // 입력 텍스트 quote만 허용

2) Change of Control / Assignment Map
   - COC 트리거 여부, 승인 필요 당사자, 딜 전/후 액션을 표로 정리
   - 결과 스키마:
     coc_map_table[]               // 각 row: {contract, coc_trigger, consent_required, counterparty, action_pre_close, action_post_close}
     action_items[]
     evidence_quotes[]

3) Indemnity Summary Table (캡/바스켓/생존기간)
   - 캡, 바스켓, 디미니미스, 생존기간, 클레임 프로세스 요약
   - 결과 스키마:
     indemnity_table {
       cap: "... or 자료 필요",
       basket: "... or 자료 필요",
       de_minimis: "... or 자료 필요",
       survival: "... or 자료 필요",
       process: "... or 자료 필요"
     }
     key_risks[]
     negotiation_points[]

────────────────────────────
[회계/재무 연계 기능 - 필수]

Streamlit UI에 "회계적 영향 분석(Accounting Impact)" 버튼을 추가한다.
이 버튼은 Legal Deep Dive 결과와 FinanceCost/QoE 모듈을 연결해
법무 이슈를 회계적으로 즉시 해석한 섹션을 생성한다.

A) Accounting Impact Mapper(새 모듈 또는 함수) 구현
- 입력:
  - legal_result (위 1~3 결과)
  - finance_result (기존 finance_cost_agent 산출물)
  - user_inputs (회사명/업종/메모/기간/엑싯 선호 등)
- 출력(JSON-like dict):
  accounting_impact = {
    contingency_map: [
      // 예: {legal_issue_type, scenario, accounting_topic, potential_fin_stmt_area, info_needed, suggested_procedure, evidence_quotes}
    ],
    ifrs_k_ifrs_topics: [
      // 예: "충당부채/우발부채(예: IAS 37/K-IFRS 1037)", "리스(예: IFRS 16)", "매출인식(예: IFRS 15)", ...
      // 단, 조문/기준번호는 확신 없으면 일반 명칭으로만 기재
    ],
    disclosure_checklist: [
      // 예: {item, why, data_needed}
    ],
    QoE_adjustment_candidates: [
      // 법무 이슈로 인해 EBITDA/현금흐름에 영향을 줄 수 있는 조정 후보(추정 금지, 자료 필요 표기)
    ],
    dd_tests_and_docs: [
      // 감사/실사 절차 관점: {test, documents_needed, owner_department}
    ],
    summary_box: {
      // "회계 관점 결론" 5줄 내: 핵심 영향/핵심 필요자료/즉시 액션
    }
  }

B) 버튼 동작
- Streamlit에서:
  - 체크박스: "Legal Deep Dive" ON 시 legal 고도화 분석 수행
  - 버튼: "회계적 영향 분석(Accounting Impact)" 클릭 시
    legal_result + finance_result를 사용해 accounting_impact 생성
  - 결과는 화면에 표/박스로 표시 + 보고서에도 포함 옵션(토글 또는 자동 포함)

C) 보고서 템플릿 반영
- report.html.j2에 "Accounting Impact (Legal x Finance)" 섹션 추가
- 반드시 표/박스 형태로 시각 강화:
  - Contingency Map Table
  - Disclosure Checklist Table
  - QoE Adjustment Candidates Box
  - Info Needed(추가 자료 필요) 강조 박스

────────────────────────────
[공통 요구]

- 숫자 추정 금지. 정보 없으면 "자료 필요"로 표시.
- Evidence(근거) 인용은 입력 텍스트에서 quote로만.
- 출력은 JSON-like dict 구조로 통일(파이썬 dict로 반환해도 됨).
- Legal Deep Dive OFF면 기존 수준(간단 법무 요약)만 수행하도록 한다.
- Accounting Impact 버튼은 Finance/Legal 둘 다 있어야 동작. 없으면 안내 메시지 표시.
